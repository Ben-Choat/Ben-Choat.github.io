<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Feliz aniversario</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Antonio:wght@400;600;700&family=Karla:wght@400;600&display=swap');

        :root {
            --night: #0b1220;
            --deep: #111c33;
            --mist: #eaf2ff;
            --glow: #77b8ff;
            --mint: #8ff2d2;
            --sun: #ffd28a;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Karla', 'Segoe UI', Arial, sans-serif;
            color: var(--mist);
        }

        body {
            display: grid;
            place-items: center;
            padding: 1.5rem;
            background:
                radial-gradient(circle at 10% 20%, rgba(119, 184, 255, 0.2), transparent 45%),
                radial-gradient(circle at 90% 10%, rgba(143, 242, 210, 0.18), transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 210, 138, 0.2), transparent 55%),
                linear-gradient(140deg, #090f1c 0%, #0f1d36 45%, #0b1324 100%);
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                linear-gradient(120deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 50%, transparent 100%),
                repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.04) 0 1px, transparent 1px 6px);
            opacity: 0.25;
            pointer-events: none;
        }

        #rain-canvas {
            position: fixed;
            inset: 0;
            z-index: 1;
            pointer-events: none;
        }

        .waterline {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 18vh;
            background:
                linear-gradient(180deg, rgba(124, 190, 255, 0.35), rgba(12, 35, 64, 0.75)),
                radial-gradient(circle at 20% 0%, rgba(255, 255, 255, 0.18), transparent 55%),
                radial-gradient(circle at 80% 20%, rgba(143, 242, 210, 0.2), transparent 60%);
            box-shadow: 0 -12px 30px rgba(12, 24, 44, 0.6);
            z-index: 5;
            pointer-events: none;
            overflow: visible;
            opacity: 0.85;
            /* transition: height 0.6s ease; */
            transition: height 1.6s ease;
        }

        .flood-buildings {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 18vh;
            height: 95%;
            display: flex;
            align-items: flex-end;
            justify-content: space-evenly;
            opacity: 0.85;
            filter: blur(0.2px);
            z-index: 1;
            pointer-events: none;
        }

        .building {
            width: 5vw;
            min-width: 36px;
            max-width: 70px;
            background: rgba(120, 160, 200, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.16);
            position: relative;
        }

        .building::after {
            content: "";
            position: absolute;
            inset: 18% 18% 22% 18%;
            background:
                repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.24) 0 3px, transparent 3px 8px),
                repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.2) 0 4px, transparent 4px 10px);
            opacity: 0.7;
        }

        .b1 { height: 70%; border-radius: 6px 6px 2px 2px; }
        .b2 { height: 92%; border-radius: 6px 6px 2px 2px; }
        .b3 { height: 58%; border-radius: 6px 6px 2px 2px; }
        .b4 { height: 88%; border-radius: 6px 6px 2px 2px; }
        .b5 { height: 78%; border-radius: 6px 6px 2px 2px; }

        .waterline::before,
        .waterline::after {
            content: "";
            position: absolute;
            left: -10%;
            right: -10%;
            height: 40%;
            top: -20px;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.25), transparent 60%);
            opacity: 0.6;
            animation: wave 12s ease-in-out infinite;
        }

        .waterline::after {
            top: 10px;
            opacity: 0.4;
            animation: wave 18s ease-in-out infinite reverse;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            50% { transform: translateX(6%); }
            100% { transform: translateX(0); }
        }

        .card {
            position: relative;
            z-index: 2;
            width: min(900px, 92vw);
            padding: clamp(1.5rem, 3vw, 3rem);
            border-radius: 28px;
            background: rgba(12, 18, 35, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 30px 80px rgba(5, 10, 25, 0.75), inset 0 0 40px rgba(119, 184, 255, 0.12);
            display: grid;
            gap: 1.5rem;
            text-align: center;
            backdrop-filter: blur(14px);
            transition: transform 0.4s ease, opacity 0.4s ease;
        }

        .card.minimized {
            transform: scale(0.12);
            opacity: 0.15;
            pointer-events: none;
        }

        .card-toggle {
            position: fixed;
            top: 1.25rem;
            right: 1.25rem;
            z-index: 6;
            background: rgba(12, 18, 35, 0.85);
            color: var(--mist);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 999px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            letter-spacing: 0.08rem;
            text-transform: uppercase;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .card-toggle:focus-visible {
            outline: 2px solid var(--glow);
            outline-offset: 2px;
        }

        .timer {
            position: fixed;
            top: 1.25rem;
            right: 11.5rem;
            z-index: 6;
            background: rgba(12, 18, 35, 0.85);
            color: var(--mist);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 999px;
            padding: 0.5rem 0.9rem;
            font-size: 0.85rem;
            letter-spacing: 0.08rem;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }

        .timer span {
            color: var(--glow);
            font-weight: 600;
        }

        .flood-alert .flood-time {
            margin-top: 1rem;
            font-size: clamp(1rem, 2.2vw, 1.6rem);
            letter-spacing: 0.1rem;
        }

        .title {
            font-family: 'Antonio', 'Impact', sans-serif;
            font-size: clamp(2.4rem, 6vw, 4.5rem);
            letter-spacing: 0.2rem;
            text-transform: uppercase;
            margin: 0;
            color: var(--sun);
            text-shadow: 0 0 25px rgba(255, 210, 138, 0.55);
            animation: titlePulse 4s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); text-shadow: 0 0 25px rgba(255, 210, 138, 0.55); }
            50% { transform: scale(1.03); text-shadow: 0 0 40px rgba(255, 210, 138, 0.85); }
        }

        .subtitle {
            font-size: clamp(1rem, 2.4vw, 1.4rem);
            text-transform: uppercase;
            letter-spacing: 0.2rem;
            margin: 0;
            color: var(--mint);
        }

        .message-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .message {
            padding: 1rem 1.2rem;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 1.05rem;
            letter-spacing: 0.05rem;
            text-transform: uppercase;
            box-shadow: inset 0 0 20px rgba(119, 184, 255, 0.08);
        }

        .highlight {
            font-weight: 600;
            color: var(--glow);
        }

        .footer-note {
            margin: 0;
            font-size: 0.9rem;
            color: rgba(234, 242, 255, 0.7);
        }

        .flood-alert {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: rgba(8, 14, 28, 0.75);
            color: #ffffff;
            font-family: 'Antonio', 'Impact', sans-serif;
            font-size: clamp(2rem, 6vw, 4rem);
            letter-spacing: 0.2rem;
            text-transform: uppercase;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            z-index: 3;
        }

        .flood-alert.show {
            opacity: 1;
        }
    </style>
</head>
<body>
<canvas id="rain-canvas"></canvas>
<div class="waterline" aria-hidden="true"></div>
<div class="flood-buildings" aria-hidden="true">
    <div class="building b1"></div>
    <div class="building b2"></div>
    <div class="building b3"></div>
    <div class="building b4"></div>
    <div class="building b5"></div>
</div>
<div class="flood-alert" role="status" aria-live="polite">
    IT IS TOTALLY FLOODED!!!
    <div class="flood-time">Time: <span id="flood-time">0.0s</span></div>
</div>
<div class="timer">Timer: <span id="run-time">0.0s</span> | Best: <span id="best-time">0.0s</span></div>
<button class="card-toggle" type="button" aria-pressed="false" aria-controls="card">Minimize card</button>
<main class="card" id="card">
    <div>
        <h1 class="title">Feliz aniversario Luciana!</h1>
        <p class="subtitle">Hydrology excellence, celebratory edition</p>
    </div>

    <div class="message-grid">
        <div class="message highlight">melhor chefe</div>
        <div class="message">hidrólogo genial</div>
        <div class="message">Feliz aniversário</div>
        <div class="message">Have a great year</div>
    </div>

    <p class="subtitle">Click the raindrops to slowdown the flooding!</p>
</main>

<script>
    const canvas = document.getElementById('rain-canvas');
    const ctx = canvas.getContext('2d');
    const drops = [];
    const dropImage = new Image();
    const waterline = document.querySelector('.waterline');
    const floodAlert = document.querySelector('.flood-alert');
    const card = document.getElementById('card');
    const cardToggle = document.querySelector('.card-toggle');
    const runTimeEl = document.getElementById('run-time');
    const floodTimeEl = document.getElementById('flood-time');
    const bestTimeEl = document.getElementById('best-time');
    dropImage.src = '/assets/RainDrop.svg';

    let dpr = Math.min(window.devicePixelRatio || 1, 2);
    // const baseGravity = 0.01;
    // const gravityGain = 0.000009;
    const baseGravity = 0.007;
    const gravityGain = 0.000001;
    let startTime = null;
    let bestTime = 0;
    let waterHeight = 18;
    const floodStep = 0.4;
    let floodResetPending = false;
    const spawnCount = 26;

    function resizeCanvas() {
        dpr = Math.min(window.devicePixelRatio || 1, 2);
        canvas.width = window.innerWidth * dpr;
        canvas.height = window.innerHeight * dpr;
        canvas.style.width = `${window.innerWidth}px`;
        canvas.style.height = `${window.innerHeight}px`;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function spawnDrop(fromTop = true) {
        const size = Math.random() * 16 + 18;
        drops.push({
            x: Math.random() * window.innerWidth,
            y: fromTop ? -Math.random() * window.innerHeight : window.innerHeight + size,
            vx: (Math.random() - 0.5) * 0.6,
            vy: Math.random() * 0.45 + 0.45,
            size,
            rotation: Math.random() * Math.PI * 2,
            spin: (Math.random() - 0.5) * 0.02
        });
    }

    function resetDrop(drop) {
        drop.x = Math.random() * window.innerWidth;
        drop.y = -drop.size - Math.random() * 120;
        drop.vx = (Math.random() - 0.5) * 0.6;
        drop.vy = Math.random() * 0.45 + 0.45;
        drop.rotation = Math.random() * Math.PI * 2;
    }

    function resetFlood() {
        waterHeight = 18;
        if (waterline) waterline.style.height = `${waterHeight}vh`;
        floodResetPending = false;
        if (floodAlert) floodAlert.classList.remove('show');
        startTime = null;
        if (runTimeEl) runTimeEl.textContent = '0.0s';
        drops.forEach(drop => resetDrop(drop));
    }

    function raiseWater() {
        if (!waterline) return;
        waterHeight = Math.min(100, waterHeight + floodStep);
        waterline.style.height = `${waterHeight}vh`;
        if (waterHeight >= 100 && !floodResetPending) {
            floodResetPending = true;
            if (floodAlert) floodAlert.classList.add('show');
            const elapsedSeconds = (performance.now() - startTime) / 1000;
            if (floodTimeEl) floodTimeEl.textContent = `${elapsedSeconds.toFixed(1)}s`;
            if (elapsedSeconds > bestTime) {
                bestTime = elapsedSeconds;
                if (bestTimeEl) bestTimeEl.textContent = `${bestTime.toFixed(1)}s`;
            }
            setTimeout(resetFlood, 1500);
        }
    }

    function updateDrops(timestamp = 0) {
        if (startTime === null) startTime = timestamp;
        const elapsed = timestamp - startTime;
        const gravity = baseGravity + elapsed * gravityGain;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (runTimeEl) runTimeEl.textContent = `${(elapsed / 1000).toFixed(1)}s`;

        for (const drop of drops) {
            drop.vy += gravity;
            drop.x += drop.vx;
            drop.y += drop.vy;
            drop.rotation += drop.spin;

            if (drop.y - drop.size > window.innerHeight + 30) {
                raiseWater();
                resetDrop(drop);
            }

            if (drop.x < -drop.size) drop.x = window.innerWidth + drop.size;
            if (drop.x > window.innerWidth + drop.size) drop.x = -drop.size;

            ctx.save();
            ctx.translate(drop.x, drop.y);
            ctx.rotate(drop.rotation);
            ctx.drawImage(dropImage, -drop.size / 2, -drop.size / 2, drop.size, drop.size * 1.4);
            ctx.restore();
        }

        requestAnimationFrame(updateDrops);
    }

    function handleClick(event) {
        const clickX = event.clientX;
        const clickY = event.clientY;
        let closest = null;
        let minDist = Infinity;

        for (const drop of drops) {
            const dx = drop.x - clickX;
            const dy = drop.y - clickY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const hitRadius = drop.size * 1.6;

            if (distance < hitRadius && distance < minDist) {
                minDist = distance;
                closest = drop;
            }
        }

        if (!closest) {
            // If no direct hit, grab the nearest drop within a generous radius.
            for (const drop of drops) {
                const dx = drop.x - clickX;
                const dy = drop.y - clickY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < 140 && distance < minDist) {
                    minDist = distance;
                    closest = drop;
                }
            }
        }

        if (closest) {
            // closest.vy = -Math.max(3.4, Math.abs(closest.vy) * 0.8);
            // closest.vy = -Math.max(3.4, Math.abs(closest.vy) * 1.4);
            closest.vy = -Math.max(3.4, Math.abs(closest.vy) * 1.2);
            // closest.vx += (Math.random() - 0.5) * 0.35;
            closest.vx += (Math.random() - 0.5) * 0.75;
        }
    }

    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('click', handleClick);
    window.addEventListener('pointerdown', handleClick);
    resizeCanvas();
    if (waterline) waterline.style.height = `${waterHeight}vh`;

    if (card && cardToggle) {
        cardToggle.addEventListener('click', () => {
            const isMinimized = card.classList.toggle('minimized');
            cardToggle.setAttribute('aria-pressed', String(isMinimized));
            cardToggle.textContent = isMinimized ? 'Show card' : 'Minimize card';
        });
    }

    dropImage.onload = () => {
        drops.length = 0;
        for (let i = 0; i < spawnCount; i++) {
            spawnDrop(true);
        }
        updateDrops();
    };

    dropImage.onerror = () => {
        console.error('Failed to load /assets/RainDrop.svg');
    };
</script>
</body>
</html>
